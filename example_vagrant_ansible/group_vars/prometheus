---
blackbox_exporter_configuration_modules:
  http_2xx:
    prober: http
    timeout: 5s
    http:
      preferred_ip_protocol: ip4

prometheus_scrape_configs:
  - job_name: blackbox-exporter
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
        - bcit.ca
        - bcitsa.ca
        - google.ca
        - google.co.za
        - learn.bcit.ca
        - my.bcit.ca
        - reddit.com
        - bitbucket.org
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: 127.0.0.1:9115
  - job_name: node-exporter
    file_sd_configs:
    - files:
      - /etc/prometheus/file_sd/node-exporter.yml
  - job_name: prometheus-exporter
    file_sd_configs:
    - files:
      - /etc/prometheus/file_sd/prometheus-exporter.yml

prometheus_targets:
  node-exporter:
    - targets:
        "{{ groups['all'] | map('extract', hostvars, ['ansible_host']) | map('regex_replace', '$', ':9100') | list | sort }}"
  prometheus-exporter:
    - targets:
        "{{ groups['prometheus'] | map('extract', hostvars, ['ansible_host']) | map('regex_replace', '$', ':9090') | list | sort }}"
